<!DOCTYPE html><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>[Personal Note] Why do we have all these kinds of update?</title>
<!--Generated on Fri Apr 15 13:52:02 2022 by LaTeXML (version 0.8.6) http://dlmf.nist.gov/LaTeXML/.-->

<link rel="stylesheet" href="LaTeXML.css" type="text/css">
<link rel="stylesheet" href="ltx-article.css" type="text/css">
<link rel="stylesheet" href="ltx-listings.css" type="text/css">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
</head>
<body>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line">
<h1 class="ltx_title ltx_title_document">[Personal Note] Why do we have all these kinds of update?</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Tri Nguyen 
<br class="ltx_break"><span class="ltx_text ltx_font_typewriter">nguyetr9@oregonstate.edu</span> 
<br class="ltx_break">
</span></span>
</div>
<span class="ltx_ERROR undefined">\MakePerPage</span>
<div id="p1" class="ltx_para">
<p class="ltx_p">footnote  






<span class="ltx_ERROR undefined">\addbibresource</span>refs.bib



<span class="ltx_ERROR undefined">\SetCommentSty</span>mycommfont











 















</p>
</div>
<div id="p2" class="ltx_para">
<p class="ltx_p">In this paper <span class="ltx_ERROR undefined">\parencite</span>madjiheurem2021expected, the authors motivate their new type of updates with this line of reasoning. The well-known TD-update only update value of the immediately preceding states (given if the reward is not zero). The eligibility trace improves upon this by making the update propagating back multiple states along the observed trajectory. Then they proposed that we can even make a step further by not only updating all states along observed trajectory but also all “plausible” counterfactual trajectories.</p>
</div>
<div id="p3" class="ltx_para">
<p class="ltx_p">Although the reasoning is nicely motivated, I am not convinced and want to know why or how do we have all these kinds of updating. There should be a principle that they are all based on which the author seemingly assume all audience are aware of. I think the origin problem starts with the TD-update. Let’s trace back from it.</p>
</div>
<section id="S0.SS0.SSS0.Px1" class="ltx_paragraph">
<h2 class="ltx_title ltx_title_paragraph">RL Goal.</h2>

<div id="S0.SS0.SSS0.Px1.p1" class="ltx_para">
<p class="ltx_p">While the ultimate goal of using RL might be abstract and unqualitative, one must explicitly provide some objective so that we can have a certain of how good/bad are we doing. One of the such common goal is discounted cumulative reward. Be aware of that there are others goal, the reason of choosing this is out of scope for now. It is defined as</p>
<table id="S0.Ex1" class="ltx_equation ltx_eqn_table">

<tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S0.Ex1.m1" class="ltx_Math" alttext="G_{\pi}=\mathbb{E}\left[\sum^{\infty}_{t=0}\gamma^{t}r_{t}\right]" display="block"><mrow><msub><mi>G</mi><mi>π</mi></msub><mo>=</mo><mrow><mi>𝔼</mi><mo>⁢</mo><mrow><mo>[</mo><mrow><munderover><mo largeop="true" movablelimits="false" symmetric="true">∑</mo><mrow><mi>t</mi><mo>=</mo><mn>0</mn></mrow><mi mathvariant="normal">∞</mi></munderover><mrow><msup><mi>γ</mi><mi>t</mi></msup><mo>⁢</mo><msub><mi>r</mi><mi>t</mi></msub></mrow></mrow><mo>]</mo></mrow></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr>
</table>
<p class="ltx_p">where the expectation is token over all available random variables. So we want to maximize a sum of all rewards, including the immediate reward with higher weight and future rewards with less significant weightings, and taking its average over multiple run.</p>
</div>
<div id="S0.SS0.SSS0.Px1.p2" class="ltx_para">
</div>
<div id="block_counter1" class="ltx_theorem ltx_theorem_blockx" style="background-color:#FFECD9;">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold">Block 1</span></span><span class="ltx_text ltx_font_bold">.</span>
</h6>
<div id="block_counter1.p1" class="ltx_para">
<p class="ltx_p">The goal does not concern with variance, which means it might output a good policy in terms of average but might be very very unstable, e.g., getting a very high <math id="block_counter1.p1.m1" class="ltx_Math" alttext="G" display="inline"><mi mathbackground="#FFECD9">G</mi></math> on a particular run, and moderate <math id="block_counter1.p1.m2" class="ltx_Math" alttext="G" display="inline"><mi mathbackground="#FFECD9">G</mi></math> for other <math id="block_counter1.p1.m3" class="ltx_Math" alttext="99" display="inline"><mn mathbackground="#FFECD9">99</mn></math> runs.</p>
</div>
</div>
</section>
<section id="S0.SS0.SSS0.Px2" class="ltx_paragraph">
<h2 class="ltx_title ltx_title_paragraph">Notation.</h2>

<div id="S0.SS0.SSS0.Px2.p1" class="ltx_para">
<p class="ltx_p">We use <math id="S0.SS0.SSS0.Px2.p1.m1" class="ltx_Math" alttext="S_{i}" display="inline"><msub><mi>S</mi><mi>i</mi></msub></math> as a random variable of state at time step <math id="S0.SS0.SSS0.Px2.p1.m2" class="ltx_Math" alttext="t" display="inline"><mi>t</mi></math>, <math id="S0.SS0.SSS0.Px2.p1.m3" class="ltx_Math" alttext="s_{i}" display="inline"><msub><mi>s</mi><mi>i</mi></msub></math> as a particular state in a set of states <math id="S0.SS0.SSS0.Px2.p1.m4" class="ltx_Math" alttext="\mathcal{S},\left\lvert\mathcal{S}\right\rvert=N" display="inline"><mrow><mrow><mi class="ltx_font_mathcaligraphic">𝒮</mi><mo>,</mo><mrow><mo fence="true">|</mo><mi class="ltx_font_mathcaligraphic">𝒮</mi><mo fence="true">|</mo></mrow></mrow><mo>=</mo><mi>N</mi></mrow></math>. Similar, <math id="S0.SS0.SSS0.Px2.p1.m5" class="ltx_Math" alttext="A_{i}" display="inline"><msub><mi>A</mi><mi>i</mi></msub></math> is used as a random variable of action at time step <math id="S0.SS0.SSS0.Px2.p1.m6" class="ltx_Math" alttext="i" display="inline"><mi>i</mi></math>, <math id="S0.SS0.SSS0.Px2.p1.m7" class="ltx_Math" alttext="a_{i}" display="inline"><msub><mi>a</mi><mi>i</mi></msub></math> as a particular action in a set of actions <math id="S0.SS0.SSS0.Px2.p1.m8" class="ltx_Math" alttext="\mathcal{A},\left\lvert\mathcal{A}\right\rvert=M" display="inline"><mrow><mrow><mi class="ltx_font_mathcaligraphic">𝒜</mi><mo>,</mo><mrow><mo fence="true">|</mo><mi class="ltx_font_mathcaligraphic">𝒜</mi><mo fence="true">|</mo></mrow></mrow><mo>=</mo><mi>M</mi></mrow></math>;
<math id="S0.SS0.SSS0.Px2.p1.m9" class="ltx_Math" alttext="r(S_{i},A_{i}):\mathcal{S}\times\mathcal{A}\rightarrow\mathbb{R}" display="inline"><mrow><mrow><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mi>i</mi></msub><mo>,</mo><msub><mi>A</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo>:</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">𝒮</mi><mo>×</mo><mi class="ltx_font_mathcaligraphic">𝒜</mi></mrow><mo>→</mo><mi>ℝ</mi></mrow></mrow></math> as a reward received at time step <math id="S0.SS0.SSS0.Px2.p1.m10" class="ltx_Math" alttext="i" display="inline"><mi>i</mi></math>;</p>
</div>
</section>
<section id="S0.SS0.SSS0.Px3" class="ltx_paragraph">
<h2 class="ltx_title ltx_title_paragraph">Dynamic programming.</h2>

<div id="S0.SS0.SSS0.Px3.p1" class="ltx_para">
<p class="ltx_p">A way to decompose this <math id="S0.SS0.SSS0.Px3.p1.m1" class="ltx_Math" alttext="G" display="inline"><mi>G</mi></math> is
</p>
<table id="S0.EGx1" class="ltx_equationgroup ltx_eqn_align ltx_eqn_table">

<tbody id="S0.Ex2"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math id="S0.Ex2.m1" class="ltx_Math" alttext="\displaystyle G_{\pi}" display="inline"><msub><mi>G</mi><mi>π</mi></msub></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S0.Ex2.m2" class="ltx_Math" alttext="\displaystyle=\mathbb{E}\left[r(S_{0},A_{0})+\gamma r(S_{1},A_{1})+\gamma^{2}r%
(S_{2},A_{2})+\ldots+\gamma^{t}r(S_{t},A_{t})+\ldots\right]" display="inline"><mrow><mi></mi><mo>=</mo><mrow><mi>𝔼</mi><mo>⁢</mo><mrow><mo>[</mo><mrow><mrow><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>0</mn></msub><mo>,</mo><msub><mi>A</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>γ</mi><mo>⁢</mo><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>1</mn></msub><mo>,</mo><msub><mi>A</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><msup><mi>γ</mi><mn>2</mn></msup><mo>⁢</mo><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>,</mo><msub><mi>A</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mi mathvariant="normal">…</mi><mo>+</mo><mrow><msup><mi>γ</mi><mi>t</mi></msup><mo>⁢</mo><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mi>t</mi></msub><mo>,</mo><msub><mi>A</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mi mathvariant="normal">…</mi></mrow><mo>]</mo></mrow></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S0.Ex3"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S0.Ex3.m1" class="ltx_Math" alttext="\displaystyle=\mathbb{E}\left[r(S_{0},A_{0})+\gamma\underbrace{\mathbb{E}\left%
[r(S_{1},A_{1})+\ldots+\gamma^{t-1}r(S_{t},A_{t})+\ldots\right]}_{\text{this %
term is still a RV}}\right]" display="inline"><mrow><mi></mi><mo>=</mo><mrow><mi>𝔼</mi><mo>⁢</mo><mrow><mo>[</mo><mrow><mrow><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>0</mn></msub><mo>,</mo><msub><mi>A</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>γ</mi><mo>⁢</mo><munder><munder accentunder="true"><mrow><mi>𝔼</mi><mo movablelimits="false">⁢</mo><mrow><mo movablelimits="false">[</mo><mrow><mrow><mi>r</mi><mo movablelimits="false">⁢</mo><mrow><mo movablelimits="false" stretchy="false">(</mo><msub><mi>S</mi><mn>1</mn></msub><mo movablelimits="false">,</mo><msub><mi>A</mi><mn>1</mn></msub><mo movablelimits="false" stretchy="false">)</mo></mrow></mrow><mo movablelimits="false">+</mo><mi mathvariant="normal">…</mi><mo movablelimits="false">+</mo><mrow><msup><mi>γ</mi><mrow><mi>t</mi><mo movablelimits="false">-</mo><mn>1</mn></mrow></msup><mo movablelimits="false">⁢</mo><mi>r</mi><mo movablelimits="false">⁢</mo><mrow><mo movablelimits="false" stretchy="false">(</mo><msub><mi>S</mi><mi>t</mi></msub><mo movablelimits="false">,</mo><msub><mi>A</mi><mi>t</mi></msub><mo movablelimits="false" stretchy="false">)</mo></mrow></mrow><mo movablelimits="false">+</mo><mi mathvariant="normal">…</mi></mrow><mo movablelimits="false">]</mo></mrow></mrow><mo movablelimits="false">⏟</mo></munder><mtext>this term is still a RV</mtext></munder></mrow></mrow><mo>]</mo></mrow></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S0.Ex4"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S0.Ex4.m1" class="ltx_Math" alttext="\displaystyle=\mathbb{E}[r(S_{0},A_{0})+\gamma V(S_{1})]," display="inline"><mrow><mrow><mi></mi><mo>=</mo><mrow><mi>𝔼</mi><mo>⁢</mo><mrow><mo stretchy="false">[</mo><mrow><mrow><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>0</mn></msub><mo>,</mo><msub><mi>A</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>γ</mi><mo>⁢</mo><mi>V</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow><mo>,</mo></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p">where we define something called value function as follow.</p>
</div>
<div id="S0.SS0.SSS0.Px3.p2" class="ltx_para">
</div>
<div id="definition_counter1" class="ltx_theorem ltx_theorem_definitionx" style="background-color:#000000;">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold">Definition 1</span></span><span class="ltx_text ltx_font_bold"> </span>(Value function)<span class="ltx_text ltx_font_bold">.</span>
</h6>
<div id="definition_counter1.p1" class="ltx_para">
<p class="ltx_p">A value function of a policy is a real-value function, <math id="definition_counter1.p1.m1" class="ltx_Math" alttext="V_{\pi}:\mathcal{S}\rightarrow R" display="inline"><mrow><msub><mi mathbackground="#000000">V</mi><mi mathbackground="#000000">π</mi></msub><mo mathbackground="#000000">:</mo><mrow><mi class="ltx_font_mathcaligraphic" mathbackground="#000000">𝒮</mi><mo mathbackground="#000000">→</mo><mi mathbackground="#000000">R</mi></mrow></mrow></math>, and is defined as</p>
<table id="S0.E1" class="ltx_equation ltx_eqn_table">

<tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S0.E1.m1" class="ltx_Math" alttext="V_{\pi}(S_{1}=s):=\mathbb{E}\left[r(s,A_{1})+\gamma r(S_{2},A_{2})+\ldots+%
\gamma^{t-1}r(S_{t},A_{t})+\ldots|S_{1}=s\right]" display="block"><mrow><mrow><msub><mi mathbackground="#000000">V</mi><mi mathbackground="#000000">π</mi></msub><mo mathbackground="#000000">⁢</mo><mrow><mo mathbackground="#000000" stretchy="false">(</mo><mrow><msub><mi mathbackground="#000000">S</mi><mn mathbackground="#000000">1</mn></msub><mo mathbackground="#000000">=</mo><mi mathbackground="#000000">s</mi></mrow><mo mathbackground="#000000" stretchy="false">)</mo></mrow></mrow><mo mathbackground="#000000">:=</mo><mrow><mi mathbackground="#000000">𝔼</mi><mo mathbackground="#000000">⁢</mo><mrow><mo mathbackground="#000000">[</mo><mrow><mrow><mrow><mi mathbackground="#000000">r</mi><mo mathbackground="#000000">⁢</mo><mrow><mo mathbackground="#000000" stretchy="false">(</mo><mi mathbackground="#000000">s</mi><mo mathbackground="#000000">,</mo><msub><mi mathbackground="#000000">A</mi><mn mathbackground="#000000">1</mn></msub><mo mathbackground="#000000" stretchy="false">)</mo></mrow></mrow><mo mathbackground="#000000">+</mo><mrow><mi mathbackground="#000000">γ</mi><mo mathbackground="#000000">⁢</mo><mi mathbackground="#000000">r</mi><mo mathbackground="#000000">⁢</mo><mrow><mo mathbackground="#000000" stretchy="false">(</mo><msub><mi mathbackground="#000000">S</mi><mn mathbackground="#000000">2</mn></msub><mo mathbackground="#000000">,</mo><msub><mi mathbackground="#000000">A</mi><mn mathbackground="#000000">2</mn></msub><mo mathbackground="#000000" stretchy="false">)</mo></mrow></mrow><mo mathbackground="#000000">+</mo><mi mathbackground="#000000" mathvariant="normal">…</mi><mo mathbackground="#000000">+</mo><mrow><msup><mi mathbackground="#000000">γ</mi><mrow><mi mathbackground="#000000">t</mi><mo mathbackground="#000000">-</mo><mn mathbackground="#000000">1</mn></mrow></msup><mo mathbackground="#000000">⁢</mo><mi mathbackground="#000000">r</mi><mo mathbackground="#000000">⁢</mo><mrow><mo mathbackground="#000000" stretchy="false">(</mo><msub><mi mathbackground="#000000">S</mi><mi mathbackground="#000000">t</mi></msub><mo mathbackground="#000000">,</mo><msub><mi mathbackground="#000000">A</mi><mi mathbackground="#000000">t</mi></msub><mo mathbackground="#000000" stretchy="false">)</mo></mrow></mrow><mo mathbackground="#000000">+</mo><mrow><mi mathbackground="#000000" mathvariant="normal">…</mi><mo lspace="2.5pt" mathbackground="#000000" rspace="2.5pt" stretchy="false">|</mo><msub><mi mathbackground="#000000">S</mi><mn mathbackground="#000000">1</mn></msub></mrow></mrow><mo mathbackground="#000000">=</mo><mi mathbackground="#000000">s</mi></mrow><mo mathbackground="#000000">]</mo></mrow></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr>
</table>
<p class="ltx_p">where <math id="definition_counter1.p1.m2" class="ltx_Math" alttext="S_{1}" display="inline"><msub><mi mathbackground="#000000">S</mi><mn mathbackground="#000000">1</mn></msub></math> is the state input, <math id="definition_counter1.p1.m3" class="ltx_Math" alttext="S_{2},S_{3},\ldots" display="inline"><mrow><msub><mi mathbackground="#000000">S</mi><mn mathbackground="#000000">2</mn></msub><mo mathbackground="#000000">,</mo><msub><mi mathbackground="#000000">S</mi><mn mathbackground="#000000">3</mn></msub><mo mathbackground="#000000">,</mo><mi mathbackground="#000000" mathvariant="normal">…</mi></mrow></math> are next states relatively to <math id="definition_counter1.p1.m4" class="ltx_Math" alttext="S_{1}" display="inline"><msub><mi mathbackground="#000000">S</mi><mn mathbackground="#000000">1</mn></msub></math> (index <math id="definition_counter1.p1.m5" class="ltx_Math" alttext="1" display="inline"><mn mathbackground="#000000">1</mn></math> does not mean anything specific here, just indicate a relative temporal index).</p>
</div>
</div>
<div id="S0.SS0.SSS0.Px3.p3" class="ltx_para">
<p class="ltx_p">The conditioning <math id="S0.SS0.SSS0.Px3.p3.m1" class="ltx_Math" alttext="S_{1}=s" display="inline"><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><mi>s</mi></mrow></math> is necessary since all remaining RVs <math id="S0.SS0.SSS0.Px3.p3.m2" class="ltx_Math" alttext="A_{1},S_{2},A_{2},\ldots" display="inline"><mrow><msub><mi>A</mi><mn>1</mn></msub><mo>,</mo><msub><mi>S</mi><mn>2</mn></msub><mo>,</mo><msub><mi>A</mi><mn>2</mn></msub><mo>,</mo><mi mathvariant="normal">…</mi></mrow></math> depend on that information. To make it clear, take a look at a quantity without that condition</p>
<table id="S0.Ex5" class="ltx_equation ltx_eqn_table">

<tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S0.Ex5.m1" class="ltx_Math" alttext="\mathbb{E}\left[r(s,A_{1})+\gamma r(S_{2},A_{2})+\ldots+\gamma^{t-1}r(S_{t},A_%
{t})+\ldots\right]" display="block"><mrow><mi>𝔼</mi><mo>⁢</mo><mrow><mo>[</mo><mrow><mrow><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><msub><mi>A</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>γ</mi><mo>⁢</mo><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>,</mo><msub><mi>A</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mi mathvariant="normal">…</mi><mo>+</mo><mrow><msup><mi>γ</mi><mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow></msup><mo>⁢</mo><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mi>t</mi></msub><mo>,</mo><msub><mi>A</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mi mathvariant="normal">…</mi></mrow><mo>]</mo></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr>
</table>
<p class="ltx_p">Since it needs to be deterministic, the expectation is taking over <math id="S0.SS0.SSS0.Px3.p3.m3" class="ltx_Math" alttext="A_{1}" display="inline"><msub><mi>A</mi><mn>1</mn></msub></math>, which makes no sense since there is no <math id="S0.SS0.SSS0.Px3.p3.m4" class="ltx_Math" alttext="P(A_{1})" display="inline"><mrow><mi>P</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>A</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow></math>, we only have <math id="S0.SS0.SSS0.Px3.p3.m5" class="ltx_Math" alttext="P(A_{1}|S_{1})" display="inline"><mrow><mi>P</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mrow><msub><mi>A</mi><mn>1</mn></msub><mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mo><msub><mi>S</mi><mn>1</mn></msub></mrow><mo stretchy="false">)</mo></mrow></mrow></math>. Similarly, the expectation is taking over <math id="S0.SS0.SSS0.Px3.p3.m6" class="ltx_Math" alttext="S_{2}\sim P(S_{2})" display="inline"><mrow><msub><mi>S</mi><mn>2</mn></msub><mo>∼</mo><mrow><mi>P</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></math>. This is again wrong since doing this takes no account for a piece of observation that previous state is <math id="S0.SS0.SSS0.Px3.p3.m7" class="ltx_Math" alttext="S_{1}=s" display="inline"><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><mi>s</mi></mrow></math>. This can go on …</p>
</div>
<div id="remark_counter0.Thmremark1" class="ltx_theorem ltx_theorem_remark">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_italic">Remark 0.1</span></span><span class="ltx_text ltx_font_italic">.</span>
</h6>
<div id="remark_counter0.Thmremark1.p1" class="ltx_para">
<p class="ltx_p">Value function at a state <math id="remark_counter0.Thmremark1.p1.m1" class="ltx_Math" alttext="s" display="inline"><mi>s</mi></math>, i.e., <math id="remark_counter0.Thmremark1.p1.m2" class="ltx_Math" alttext="V_{\pi}(S_{1}=s)" display="inline"><mrow><msub><mi>V</mi><mi>π</mi></msub><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><mi>s</mi></mrow><mo stretchy="false">)</mo></mrow></mrow></math> is a deterministic quantity.</p>
</div>
</div>
<div id="remark_counter0.Thmremark2" class="ltx_theorem ltx_theorem_remark">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_italic">Remark 0.2</span></span><span class="ltx_text ltx_font_italic">.</span>
</h6>
<div id="remark_counter0.Thmremark2.p1" class="ltx_para">
<p class="ltx_p">Value function is time invariant, i.e., <math id="remark_counter0.Thmremark2.p1.m1" class="ltx_Math" alttext="V_{\pi}(S_{t}=s)=V_{\pi}(S_{k}=s)" display="inline"><mrow><mrow><msub><mi>V</mi><mi>π</mi></msub><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mrow><msub><mi>S</mi><mi>t</mi></msub><mo>=</mo><mi>s</mi></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><msub><mi>V</mi><mi>π</mi></msub><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mrow><msub><mi>S</mi><mi>k</mi></msub><mo>=</mo><mi>s</mi></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow></math> for any <math id="remark_counter0.Thmremark2.p1.m2" class="ltx_Math" alttext="t,k\geq 0" display="inline"><mrow><mrow><mi>t</mi><mo>,</mo><mi>k</mi></mrow><mo>≥</mo><mn>0</mn></mrow></math>.</p>
</div>
</div>
<div id="S0.SS0.SSS0.Px3.p4" class="ltx_para">
<p class="ltx_p">Since it is time invariant, we will use <math id="S0.SS0.SSS0.Px3.p4.m1" class="ltx_Math" alttext="V_{\pi}(S_{1})" display="inline"><mrow><msub><mi>V</mi><mi>π</mi></msub><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow></math> as convention.</p>
</div>
<div id="remark_counter0.Thmremark3" class="ltx_theorem ltx_theorem_remark">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_italic">Remark 0.3</span></span><span class="ltx_text ltx_font_italic">.</span>
</h6>
<div id="remark_counter0.Thmremark3.p1" class="ltx_para">
<p class="ltx_p">Value function of a state can be described by value function of other states.</p>
<table id="S0.EGx2" class="ltx_equationgroup ltx_eqn_align ltx_eqn_table">

<tbody id="S0.Ex6"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math id="S0.Ex6.m1" class="ltx_Math" alttext="\displaystyle V_{\pi}(S_{1}=s)" display="inline"><mrow><msub><mi>V</mi><mi>π</mi></msub><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><mi>s</mi></mrow><mo stretchy="false">)</mo></mrow></mrow></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S0.Ex6.m2" class="ltx_Math" alttext="\displaystyle=\mathbb{E}[r(s,A_{1})+\gamma r(S_{2},A_{2})+\ldots+\gamma^{t-1}r%
(S_{t},A_{t})+\ldots|S_{1}=s]" display="inline"><mrow><mi></mi><mo>=</mo><mrow><mi>𝔼</mi><mo>⁢</mo><mrow><mo stretchy="false">[</mo><mrow><mrow><mrow><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><msub><mi>A</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>γ</mi><mo>⁢</mo><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>,</mo><msub><mi>A</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mi mathvariant="normal">…</mi><mo>+</mo><mrow><msup><mi>γ</mi><mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow></msup><mo>⁢</mo><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mi>t</mi></msub><mo>,</mo><msub><mi>A</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi mathvariant="normal">…</mi><mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mo><msub><mi>S</mi><mn>1</mn></msub></mrow></mrow><mo>=</mo><mi>s</mi></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S0.Ex7"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S0.Ex7.m1" class="ltx_Math" alttext="\displaystyle=\mathbb{E}_{A_{1}}\left[r(s,A_{1})+\gamma\mathbb{E}[r(S_{2},A_{2%
})+\ldots+\gamma^{t-1}r(S_{t},A_{t})+\ldots]\mid S_{1}=s\right]\quad\text{(%
splitting RVs)}" display="inline"><mrow><mi></mi><mo>=</mo><mrow><mrow><msub><mi>𝔼</mi><msub><mi>A</mi><mn>1</mn></msub></msub><mo>⁢</mo><mrow><mo>[</mo><mrow><mrow><mrow><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><msub><mi>A</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mrow><mi>γ</mi><mo>⁢</mo><mi>𝔼</mi><mo>⁢</mo><mrow><mo stretchy="false">[</mo><mrow><mrow><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>,</mo><msub><mi>A</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mi mathvariant="normal">…</mi><mo>+</mo><mrow><msup><mi>γ</mi><mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow></msup><mo>⁢</mo><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mi>t</mi></msub><mo>,</mo><msub><mi>A</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mi mathvariant="normal">…</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo lspace="2.5pt" rspace="2.5pt">∣</mo><msub><mi>S</mi><mn>1</mn></msub></mrow></mrow><mo>=</mo><mi>s</mi></mrow><mo>]</mo></mrow></mrow><mo mathvariant="italic" separator="true"> </mo><mtext>(splitting RVs)</mtext></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S0.Ex8"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S0.Ex8.m1" class="ltx_Math" alttext="\displaystyle=\sum_{i=1}\text{Pr}(A_{1}=a_{i}|S_{1}=s)\left(r(s,a_{i})+\gamma%
\mathbb{E}[r(S_{2},A_{2})+\ldots+\gamma^{t-1}r(S_{t},A_{t})+\ldots\mid S_{1}=s%
,A_{1}=a_{i}]\right)" display="inline"><mrow><mi></mi><mo>=</mo><mrow><mstyle displaystyle="true"><munder><mo largeop="true" movablelimits="false" symmetric="true">∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow></munder></mstyle><mrow><mtext>Pr</mtext><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mrow><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><mrow><msub><mi>a</mi><mi>i</mi></msub><mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mo><msub><mi>S</mi><mn>1</mn></msub></mrow><mo>=</mo><mi>s</mi></mrow><mo stretchy="false">)</mo></mrow><mo>⁢</mo><mrow><mo>(</mo><mrow><mrow><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>γ</mi><mo>⁢</mo><mi>𝔼</mi><mo>⁢</mo><mrow><mo stretchy="false">[</mo><mrow><mrow><mrow><mrow><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>,</mo><msub><mi>A</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mi mathvariant="normal">…</mi><mo>+</mo><mrow><msup><mi>γ</mi><mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow></msup><mo>⁢</mo><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mi>t</mi></msub><mo>,</mo><msub><mi>A</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi mathvariant="normal">…</mi><mo lspace="2.5pt" rspace="2.5pt">∣</mo><msub><mi>S</mi><mn>1</mn></msub></mrow></mrow><mo>=</mo><mi>s</mi></mrow><mo>,</mo><mrow><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow><mo>)</mo></mrow></mrow></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
</div>
<div id="S0.SS0.SSS0.Px3.p5" class="ltx_para">
<p class="ltx_p">The last term is</p>
<table id="S0.EGx3" class="ltx_equationgroup ltx_eqn_align ltx_eqn_table">

<tbody id="S0.Ex9"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S0.Ex9.m2" class="ltx_Math" alttext="\displaystyle\mathbb{E}[r(S_{2},A_{2})+\gamma r(S_{3},A_{3})+\ldots|S_{1}=s,A_%
{1}=a_{i}]" display="inline"><mrow><mi>𝔼</mi><mo>⁢</mo><mrow><mo stretchy="false">[</mo><mrow><mrow><mrow><mrow><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>,</mo><msub><mi>A</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>γ</mi><mo>⁢</mo><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>3</mn></msub><mo>,</mo><msub><mi>A</mi><mn>3</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi mathvariant="normal">…</mi><mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mo><msub><mi>S</mi><mn>1</mn></msub></mrow></mrow><mo>=</mo><mi>s</mi></mrow><mo>,</mo><mrow><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S0.Ex10"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S0.Ex10.m1" class="ltx_Math" alttext="\displaystyle=\sum_{j=1}\text{Pr}(S_{2}=s_{j}|S_{1}=s,A_{1}=a_{i})\mathbb{E}%
\left[r(s_{j},A_{2})+\gamma r(S_{3},A_{3})+\ldots|S_{1}=s,A_{1}=a_{i},S_{2}=s_%
{j}\right]" display="inline"><mrow><mo>=</mo><mstyle displaystyle="true"><munder><mo largeop="true" movablelimits="false" symmetric="true">∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow></munder></mstyle><mtext>Pr</mtext><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><msub><mi>s</mi><mi>j</mi></msub><mo stretchy="false">|</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><mi>s</mi><mo>,</mo><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><mi>𝔼</mi><mrow><mo>[</mo><mi>r</mi><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>j</mi></msub><mo>,</mo><msub><mi>A</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><mo>+</mo><mi>γ</mi><mi>r</mi><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>3</mn></msub><mo>,</mo><msub><mi>A</mi><mn>3</mn></msub><mo stretchy="false">)</mo></mrow><mo>+</mo><mi mathvariant="normal">…</mi><mo stretchy="false">|</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><mi>s</mi><mo>,</mo><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub><mo>,</mo><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><msub><mi>s</mi><mi>j</mi></msub><mo>]</mo></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S0.Ex11"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S0.Ex11.m1" class="ltx_Math" alttext="\displaystyle=\sum_{j=1}\text{Pr}(S_{2}=s_{j}|S_{1}=s,A_{1}=a_{i})\mathbb{E}%
\left[r(s_{j},A_{2})+\gamma r(S_{3},A_{3})+\ldots|S_{2}=s_{j}\right]\quad\text%
{(Markov property)}" display="inline"><mrow><mo>=</mo><mstyle displaystyle="true"><munder><mo largeop="true" movablelimits="false" symmetric="true">∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow></munder></mstyle><mtext>Pr</mtext><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><msub><mi>s</mi><mi>j</mi></msub><mo stretchy="false">|</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><mi>s</mi><mo>,</mo><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><mi>𝔼</mi><mrow><mo>[</mo><mi>r</mi><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>j</mi></msub><mo>,</mo><msub><mi>A</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><mo>+</mo><mi>γ</mi><mi>r</mi><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>3</mn></msub><mo>,</mo><msub><mi>A</mi><mn>3</mn></msub><mo stretchy="false">)</mo></mrow><mo>+</mo><mi mathvariant="normal">…</mi><mo stretchy="false">|</mo><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><msub><mi>s</mi><mi>j</mi></msub><mo>]</mo></mrow><mo mathvariant="italic" separator="true"> </mo><mtext>(Markov property)</mtext></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S0.Ex12"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S0.Ex12.m1" class="ltx_Math" alttext="\displaystyle=\sum_{j=1}\text{Pr}(S_{2}=s_{j}|S_{1}=s,A_{1}=a_{i})V_{\pi}(S_{2%
}=s_{j})" display="inline"><mrow><mo>=</mo><mstyle displaystyle="true"><munder><mo largeop="true" movablelimits="false" symmetric="true">∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow></munder></mstyle><mtext>Pr</mtext><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><msub><mi>s</mi><mi>j</mi></msub><mo stretchy="false">|</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><mi>s</mi><mo>,</mo><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><msub><mi>V</mi><mi>π</mi></msub><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><msub><mi>s</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p">Combine those,</p>
<table id="S0.Ex13" class="ltx_equation ltx_eqn_table">

<tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S0.Ex13.m1" class="ltx_Math" alttext="V_{\pi}(S_{1}=s)=\sum_{i=1}\text{Pr}(A_{1}=a_{i}|S_{1}=s)\left(r(s,a_{i})+%
\gamma\sum_{j=1}\text{Pr}(S_{2}=s_{j}\mid S_{1}=s,A_{1}=a_{i})V_{\pi}(S_{2}=s_%
{j})\right)" display="block"><mrow><msub><mi>V</mi><mi>π</mi></msub><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><mi>s</mi><mo stretchy="false">)</mo></mrow><mo>=</mo><munder><mo largeop="true" movablelimits="false" symmetric="true">∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow></munder><mtext>Pr</mtext><mrow><mo stretchy="false">(</mo><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">|</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><mi>s</mi><mo stretchy="false">)</mo></mrow><mrow><mo>(</mo><mi>r</mi><mrow><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><mo>+</mo><mi>γ</mi><munder><mo largeop="true" movablelimits="false" symmetric="true">∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow></munder><mtext>Pr</mtext><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><msub><mi>s</mi><mi>j</mi></msub><mo>∣</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><mi>s</mi><mo>,</mo><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><msub><mi>V</mi><mi>π</mi></msub><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><msub><mi>s</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><mo>)</mo></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr>
</table>
<p class="ltx_p">With deterministic policy, the outer sum reduces to a single quantity,</p>
<table id="S0.Ex14" class="ltx_equation ltx_eqn_table">

<tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S0.Ex14.m1" class="ltx_Math" alttext="V_{\pi}(S_{1}=s)=r(s,\pi(s))+\gamma\sum_{j=1}\text{Pr}(S_{2}=s_{j}\mid S_{1}=s%
,A_{1}=\pi(s))V_{\pi}(S_{2}=s_{j})" display="block"><mrow><msub><mi>V</mi><mi>π</mi></msub><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><mi>s</mi><mo stretchy="false">)</mo></mrow><mo>=</mo><mi>r</mi><mrow><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>π</mi><mrow><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo></mrow><mo stretchy="false">)</mo></mrow><mo>+</mo><mi>γ</mi><munder><mo largeop="true" movablelimits="false" symmetric="true">∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow></munder><mtext>Pr</mtext><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><msub><mi>s</mi><mi>j</mi></msub><mo>∣</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><mi>s</mi><mo>,</mo><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><mi>π</mi><mrow><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo></mrow><mo stretchy="false">)</mo></mrow><msub><mi>V</mi><mi>π</mi></msub><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><msub><mi>s</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr>
</table>
</div>
<div id="block_counter2" class="ltx_theorem ltx_theorem_blockx" style="background-color:#FFECD9;">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold">Block 2</span></span><span class="ltx_text ltx_font_bold">.</span>
</h6>
<div id="block_counter2.p1" class="ltx_para">
<p class="ltx_p">For deterministic policy,</p>
<table id="S0.Ex15" class="ltx_equation ltx_eqn_table">

<tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S0.Ex15.m1" class="ltx_Math" alttext="V_{\pi}(S_{1}=s)=r(s,\pi(s))+\gamma\sum_{j=1}\text{Pr}(S_{2}=s_{j}\mid S_{1}=s%
,A_{1}=\pi(s))V_{\pi}(S_{2}=s_{j})" display="block"><mrow><msub><mi mathbackground="#FFECD9">V</mi><mi mathbackground="#FFECD9">π</mi></msub><mrow><mo mathbackground="#FFECD9" stretchy="false">(</mo><msub><mi mathbackground="#FFECD9">S</mi><mn mathbackground="#FFECD9">1</mn></msub><mo mathbackground="#FFECD9">=</mo><mi mathbackground="#FFECD9">s</mi><mo mathbackground="#FFECD9" stretchy="false">)</mo></mrow><mo mathbackground="#FFECD9">=</mo><mi mathbackground="#FFECD9">r</mi><mrow><mo mathbackground="#FFECD9" stretchy="false">(</mo><mi mathbackground="#FFECD9">s</mi><mo mathbackground="#FFECD9">,</mo><mi mathbackground="#FFECD9">π</mi><mrow><mo mathbackground="#FFECD9" stretchy="false">(</mo><mi mathbackground="#FFECD9">s</mi><mo mathbackground="#FFECD9" stretchy="false">)</mo></mrow><mo mathbackground="#FFECD9" stretchy="false">)</mo></mrow><mo mathbackground="#FFECD9">+</mo><mi mathbackground="#FFECD9">γ</mi><munder><mo largeop="true" mathbackground="#FFECD9" movablelimits="false" symmetric="true">∑</mo><mrow><mi mathbackground="#FFECD9">j</mi><mo mathbackground="#FFECD9">=</mo><mn mathbackground="#FFECD9">1</mn></mrow></munder><mtext mathbackground="#FFECD9">Pr</mtext><mrow><mo mathbackground="#FFECD9" stretchy="false">(</mo><msub><mi mathbackground="#FFECD9">S</mi><mn mathbackground="#FFECD9">2</mn></msub><mo mathbackground="#FFECD9">=</mo><msub><mi mathbackground="#FFECD9">s</mi><mi mathbackground="#FFECD9">j</mi></msub><mo mathbackground="#FFECD9">∣</mo><msub><mi mathbackground="#FFECD9">S</mi><mn mathbackground="#FFECD9">1</mn></msub><mo mathbackground="#FFECD9">=</mo><mi mathbackground="#FFECD9">s</mi><mo mathbackground="#FFECD9">,</mo><msub><mi mathbackground="#FFECD9">A</mi><mn mathbackground="#FFECD9">1</mn></msub><mo mathbackground="#FFECD9">=</mo><mi mathbackground="#FFECD9">π</mi><mrow><mo mathbackground="#FFECD9" stretchy="false">(</mo><mi mathbackground="#FFECD9">s</mi><mo mathbackground="#FFECD9" stretchy="false">)</mo></mrow><mo mathbackground="#FFECD9" stretchy="false">)</mo></mrow><msub><mi mathbackground="#FFECD9">V</mi><mi mathbackground="#FFECD9">π</mi></msub><mrow><mo mathbackground="#FFECD9" stretchy="false">(</mo><msub><mi mathbackground="#FFECD9">S</mi><mn mathbackground="#FFECD9">2</mn></msub><mo mathbackground="#FFECD9">=</mo><msub><mi mathbackground="#FFECD9">s</mi><mi mathbackground="#FFECD9">j</mi></msub><mo mathbackground="#FFECD9" stretchy="false">)</mo></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr>
</table>
</div>
</div>
<div id="S0.SS0.SSS0.Px3.p6" class="ltx_para">
<p class="ltx_p">We can describe this more compactly using matrix/vector notation. Define the following quantities</p>
<table id="S0.EGx4" class="ltx_equationgroup ltx_eqn_align ltx_eqn_table">

<tbody id="S0.Ex16"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S0.Ex16.m1" class="ltx_Math" alttext="\displaystyle\bm{V}=[V_{\pi}(S_{1}=s_{1}),V_{\pi}(S_{1}=s_{2}),\ldots,V_{\pi}(%
S_{1}=s_{|\mathcal{S}|})]^{\!\top\!}\in\mathbb{R}^{N}," display="inline"><mrow><mrow><mi>𝑽</mi><mo>=</mo><msup><mrow><mo stretchy="false">[</mo><mrow><msub><mi>V</mi><mi>π</mi></msub><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><msub><mi>s</mi><mn>1</mn></msub></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mrow><msub><mi>V</mi><mi>π</mi></msub><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><msub><mi>s</mi><mn>2</mn></msub></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mi mathvariant="normal">…</mi><mo>,</mo><mrow><msub><mi>V</mi><mi>π</mi></msub><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><msub><mi>s</mi><mrow><mo stretchy="false">|</mo><mi class="ltx_font_mathcaligraphic">𝒮</mi><mo stretchy="false">|</mo></mrow></msub></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow><mo lspace="0.8pt" rspace="0.8pt">⊤</mo></msup><mo>∈</mo><msup><mi>ℝ</mi><mi>N</mi></msup></mrow><mo>,</mo></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S0.Ex20"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S0.Ex20.m1" class="ltx_Math" alttext="\displaystyle\bm{P}=\begin{bmatrix}\hidden@noalign{}\hfil\textstyle\text{Pr}(S%
_{2}=s_{1}|S_{1}=s_{1},A_{1}=\pi(s_{1}))&amp;\ldots&amp;\text{Pr}(S_{2}=s_{N}\mid S_{1%
}=s_{1},A_{1}=\pi(s_{1}))\\
\hidden@noalign{}\hfil\textstyle\vdots&amp;\vdots&amp;\vdots\\
\hidden@noalign{}\hfil\textstyle\text{Pr}(S_{2}=s_{1}|S_{1}=s_{N},A_{1}=\pi(s_%
{N}))&amp;\ldots&amp;\text{Pr}(S_{2}=s_{N}|S_{1}=s_{N},A_{1}=\pi(s_{N}))\end{bmatrix}%
\in\mathbb{R}^{NM\times N}," display="inline"><mrow><mrow><mi>𝑷</mi><mo>=</mo><mrow><mo>[</mo><mtable columnspacing="5pt" rowspacing="0pt"><mtr><mtd columnalign="center"><mrow><mtext>Pr</mtext><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><msub><mi>s</mi><mn>1</mn></msub><mo stretchy="false">|</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><msub><mi>s</mi><mn>1</mn></msub><mo>,</mo><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><mi>π</mi><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><mo stretchy="false">)</mo></mrow></mrow></mtd><mtd columnalign="center"><mi mathvariant="normal">…</mi></mtd><mtd columnalign="center"><mrow><mtext>Pr</mtext><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><msub><mi>s</mi><mi>N</mi></msub><mo>∣</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><msub><mi>s</mi><mn>1</mn></msub><mo>,</mo><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><mi>π</mi><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><mo stretchy="false">)</mo></mrow></mrow></mtd></mtr><mtr><mtd columnalign="center"><mi mathvariant="normal">⋮</mi></mtd><mtd columnalign="center"><mi mathvariant="normal">⋮</mi></mtd><mtd columnalign="center"><mi mathvariant="normal">⋮</mi></mtd></mtr><mtr><mtd columnalign="center"><mrow><mtext>Pr</mtext><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><msub><mi>s</mi><mn>1</mn></msub><mo stretchy="false">|</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><msub><mi>s</mi><mi>N</mi></msub><mo>,</mo><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><mi>π</mi><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>N</mi></msub><mo stretchy="false">)</mo></mrow><mo stretchy="false">)</mo></mrow></mrow></mtd><mtd columnalign="center"><mi mathvariant="normal">…</mi></mtd><mtd columnalign="center"><mrow><mtext>Pr</mtext><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><msub><mi>s</mi><mi>N</mi></msub><mo stretchy="false">|</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><msub><mi>s</mi><mi>N</mi></msub><mo>,</mo><msub><mi>A</mi><mn>1</mn></msub><mo>=</mo><mi>π</mi><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>N</mi></msub><mo stretchy="false">)</mo></mrow><mo stretchy="false">)</mo></mrow></mrow></mtd></mtr></mtable><mo>]</mo></mrow><mo>∈</mo><msup><mi>ℝ</mi><mrow><mrow><mi>N</mi><mo>⁢</mo><mi>M</mi></mrow><mo>×</mo><mi>N</mi></mrow></msup></mrow><mo>,</mo></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S0.Ex21"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S0.Ex21.m1" class="ltx_Math" alttext="\displaystyle\bm{R}=[r(s_{1},\pi(s_{1})),r(s_{2},\pi(s_{2})),\ldots,r(s_{N},%
\pi(s_{N}))]^{\!\top\!}\in\mathbb{R}^{N}" display="inline"><mrow><mi>𝑹</mi><mo>=</mo><msup><mrow><mo stretchy="false">[</mo><mrow><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mn>1</mn></msub><mo>,</mo><mrow><mi>π</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mrow><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mn>2</mn></msub><mo>,</mo><mrow><mi>π</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mi mathvariant="normal">…</mi><mo>,</mo><mrow><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>N</mi></msub><mo>,</mo><mrow><mi>π</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>N</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow><mo lspace="0.8pt" rspace="0.8pt">⊤</mo></msup><mo>∈</mo><msup><mi>ℝ</mi><mi>N</mi></msup></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p">Then, Block <a href="#block_counter2" title="Block 2. ‣ Dynamic programming. ‣ [Personal Note] Why do we have all these kinds of update?" class="ltx_ref"><span class="ltx_text ltx_ref_tag">2</span></a> can be expressed compactly as</p>
<table id="S0.Ex22" class="ltx_equation ltx_eqn_table">

<tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S0.Ex22.m1" class="ltx_Math" alttext="\bm{V}=\bm{R}+\bm{P}\bm{V}" display="block"><mrow><mi>𝑽</mi><mo>=</mo><mrow><mi>𝑹</mi><mo>+</mo><mrow><mi>𝑷</mi><mo>⁢</mo><mi>𝑽</mi></mrow></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr>
</table>
</div>
<div id="S0.SS0.SSS0.Px3.p7" class="ltx_para">
<p class="ltx_p"><span class="ltx_text" style="color:#0000FF;">well, it takes forever to reach the contraction operator :( </span>
</p>
</div>
<div id="definition_counter2" class="ltx_theorem ltx_theorem_definitionx" style="background-color:#000000;">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold">Definition 2</span></span><span class="ltx_text ltx_font_bold">.</span>
</h6>
<div id="definition_counter2.p1" class="ltx_para">
<p class="ltx_p">A action-value function of a policy <math id="definition_counter2.p1.m1" class="ltx_Math" alttext="\pi" display="inline"><mi mathbackground="#000000">π</mi></math> is a real-value function <math id="definition_counter2.p1.m2" class="ltx_Math" alttext="Q_{\pi}(s,a):\mathcal{S}\times\mathcal{A}\rightarrow\mathbb{R}" display="inline"><mrow><mrow><msub><mi mathbackground="#000000">Q</mi><mi mathbackground="#000000">π</mi></msub><mo mathbackground="#000000">⁢</mo><mrow><mo mathbackground="#000000" stretchy="false">(</mo><mi mathbackground="#000000">s</mi><mo mathbackground="#000000">,</mo><mi mathbackground="#000000">a</mi><mo mathbackground="#000000" stretchy="false">)</mo></mrow></mrow><mo mathbackground="#000000">:</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic" mathbackground="#000000">𝒮</mi><mo mathbackground="#000000">×</mo><mi class="ltx_font_mathcaligraphic" mathbackground="#000000">𝒜</mi></mrow><mo mathbackground="#000000">→</mo><mi mathbackground="#000000">ℝ</mi></mrow></mrow></math> defined as</p>
<table id="S0.Ex23" class="ltx_equation ltx_eqn_table">

<tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S0.Ex23.m1" class="ltx_Math" alttext="Q_{\pi}(S_{1}=s,A_{1}=a)=r(s,a)+" display="block"><mrow><mrow><msub><mi mathbackground="#000000">Q</mi><mi mathbackground="#000000">π</mi></msub><mo mathbackground="#000000">⁢</mo><mrow><mo mathbackground="#000000" stretchy="false">(</mo><mrow><mrow><msub><mi mathbackground="#000000">S</mi><mn mathbackground="#000000">1</mn></msub><mo mathbackground="#000000">=</mo><mi mathbackground="#000000">s</mi></mrow><mo mathbackground="#000000">,</mo><mrow><msub><mi mathbackground="#000000">A</mi><mn mathbackground="#000000">1</mn></msub><mo mathbackground="#000000">=</mo><mi mathbackground="#000000">a</mi></mrow></mrow><mo mathbackground="#000000" stretchy="false">)</mo></mrow></mrow><mo mathbackground="#000000">=</mo><mrow><mrow><mi mathbackground="#000000">r</mi><mo mathbackground="#000000">⁢</mo><mrow><mo mathbackground="#000000" stretchy="false">(</mo><mi mathbackground="#000000">s</mi><mo mathbackground="#000000">,</mo><mi mathbackground="#000000">a</mi><mo mathbackground="#000000" stretchy="false">)</mo></mrow></mrow><mo mathbackground="#000000">+</mo></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr>
</table>
</div>
</div>
<div id="S0.SS0.SSS0.Px3.p8" class="ltx_para">
<p class="ltx_p">We have partitioned <math id="S0.SS0.SSS0.Px3.p8.m1" class="ltx_Math" alttext="G_{\pi}" display="inline"><msub><mi>G</mi><mi>π</mi></msub></math> into a so-called immediate reward <math id="S0.SS0.SSS0.Px3.p8.m2" class="ltx_Math" alttext="r_{0}(S_{0},A_{0})" display="inline"><mrow><msub><mi>r</mi><mn>0</mn></msub><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>0</mn></msub><mo>,</mo><msub><mi>A</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow></math> and a future reward <math id="S0.SS0.SSS0.Px3.p8.m3" class="ltx_Math" alttext="\gamma V(S_{1})" display="inline"><mrow><mi>γ</mi><mo>⁢</mo><mi>V</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow></math>. We can actually do a further step that we decompose <math id="S0.SS0.SSS0.Px3.p8.m4" class="ltx_Math" alttext="V(S_{1})" display="inline"><mrow><mi>V</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow></math></p>
</div>
<div id="S0.SS0.SSS0.Px3.p9" class="ltx_para">
<table id="S0.EGx5" class="ltx_equationgroup ltx_eqn_align ltx_eqn_table">

<tbody id="S0.Ex24"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math id="S0.Ex24.m1" class="ltx_Math" alttext="\displaystyle V_{\pi}(S_{1})" display="inline"><mrow><msub><mi>V</mi><mi>π</mi></msub><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S0.Ex24.m2" class="ltx_Math" alttext="\displaystyle=\mathbb{E}\left[r_{1}(S_{1},A_{1})+\gamma\mathbb{E}\left[r_{2}(S%
_{2},A_{2})+\ldots+\gamma^{t-2}r_{t}(S_{t},A_{t})+\ldots\right]\right]" display="inline"><mrow><mi></mi><mo>=</mo><mrow><mi>𝔼</mi><mo>⁢</mo><mrow><mo>[</mo><mrow><mrow><msub><mi>r</mi><mn>1</mn></msub><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>1</mn></msub><mo>,</mo><msub><mi>A</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>γ</mi><mo>⁢</mo><mi>𝔼</mi><mo>⁢</mo><mrow><mo>[</mo><mrow><mrow><msub><mi>r</mi><mn>2</mn></msub><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo>,</mo><msub><mi>A</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mi mathvariant="normal">…</mi><mo>+</mo><mrow><msup><mi>γ</mi><mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow></msup><mo>⁢</mo><msub><mi>r</mi><mi>t</mi></msub><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mi>t</mi></msub><mo>,</mo><msub><mi>A</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mi mathvariant="normal">…</mi></mrow><mo>]</mo></mrow></mrow></mrow><mo>]</mo></mrow></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S0.Ex25"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S0.Ex25.m1" class="ltx_Math" alttext="\displaystyle=\mathbb{E}[r_{1}(S_{1},A_{1})+\gamma V(S_{2})]" display="inline"><mrow><mi></mi><mo>=</mo><mrow><mi>𝔼</mi><mo>⁢</mo><mrow><mo stretchy="false">[</mo><mrow><mrow><msub><mi>r</mi><mn>1</mn></msub><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>1</mn></msub><mo>,</mo><msub><mi>A</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>γ</mi><mo>⁢</mo><mi>V</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="S0.Ex26"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math id="S0.Ex26.m1" class="ltx_Math" alttext="\displaystyle=\sum_{i=1}" display="inline"><mrow><mi></mi><mo>=</mo><mstyle displaystyle="true"><munder><mo largeop="true" movablelimits="false" symmetric="true">∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow></munder></mstyle></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p"><span class="ltx_text" style="color:#0000FF;">please define what is <math id="S0.SS0.SSS0.Px3.p9.m1" class="ltx_Math" alttext="S_{i}" display="inline"><msub><mi mathcolor="#0000FF">S</mi><mi mathcolor="#0000FF">i</mi></msub></math>? a random variable?</span></p>
</div>
<div id="S0.SS0.SSS0.Px3.p10" class="ltx_para">
<p class="ltx_p">The outer expectation is taking over</p>
<ul id="S0.I1" class="ltx_itemize">
<li id="S0.I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S0.I1.i1.p1" class="ltx_para">
<p class="ltx_p"><math id="S0.I1.i1.p1.m1" class="ltx_Math" alttext="S_{0}" display="inline"><msub><mi>S</mi><mn>0</mn></msub></math></p>
</div>
</li>
<li id="S0.I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S0.I1.i2.p1" class="ltx_para">
<p class="ltx_p">Policy <math id="S0.I1.i2.p1.m1" class="ltx_Math" alttext="\pi" display="inline"><mi>π</mi></math> at <math id="S0.I1.i2.p1.m2" class="ltx_Math" alttext="S_{0}" display="inline"><msub><mi>S</mi><mn>0</mn></msub></math>.</p>
</div>
</li>
<li id="S0.I1.i3" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S0.I1.i3.p1" class="ltx_para">
<p class="ltx_p">Reward at <math id="S0.I1.i3.p1.m1" class="ltx_Math" alttext="S_{0}" display="inline"><msub><mi>S</mi><mn>0</mn></msub></math>, i.e., <math id="S0.I1.i3.p1.m2" class="ltx_Math" alttext="r(S_{0},A_{0})" display="inline"><mrow><mi>r</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>S</mi><mn>0</mn></msub><mo>,</mo><msub><mi>A</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow></math>.</p>
</div>
</li>
<li id="S0.I1.i4" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S0.I1.i4.p1" class="ltx_para">
<p class="ltx_p">Transition from <math id="S0.I1.i4.p1.m1" class="ltx_Math" alttext="S_{0}" display="inline"><msub><mi>S</mi><mn>0</mn></msub></math> to <math id="S0.I1.i4.p1.m2" class="ltx_Math" alttext="S_{1}" display="inline"><msub><mi>S</mi><mn>1</mn></msub></math>, i.e., <math id="S0.I1.i4.p1.m3" class="ltx_Math" alttext="p(S_{1}|S_{0},A_{0})" display="inline"><mrow><mi>p</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mrow><msub><mi>S</mi><mn>1</mn></msub><mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mo><mrow><msub><mi>S</mi><mn>0</mn></msub><mo>,</mo><msub><mi>A</mi><mn>0</mn></msub></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></math>.</p>
</div>
</li>
</ul>
</div>
<div id="S0.SS0.SSS0.Px3.p11" class="ltx_para">
<p class="ltx_p">Now after we are clear about objective, and getting some insight, let’s talk about method. Define an operator <math id="S0.SS0.SSS0.Px3.p11.m1" class="ltx_Math" alttext="\mathcal{T}" display="inline"><mi class="ltx_font_mathcaligraphic">𝒯</mi></math> that receives an array <math id="S0.SS0.SSS0.Px3.p11.m2" class="ltx_Math" alttext="\bm{V}\in\mathbb{R}^{|\mathcal{S}|}" display="inline"><mrow><mi>𝑽</mi><mo>∈</mo><msup><mi>ℝ</mi><mrow><mo stretchy="false">|</mo><mi class="ltx_font_mathcaligraphic">𝒮</mi><mo stretchy="false">|</mo></mrow></msup></mrow></math>, it will output another vector with the same dimension. Vector <math id="S0.SS0.SSS0.Px3.p11.m3" class="ltx_Math" alttext="\bm{V}" display="inline"><mi>𝑽</mi></math> is defined as</p>
<table id="S0.Ex27" class="ltx_equation ltx_eqn_table">

<tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S0.Ex27.m1" class="ltx_Math" alttext="\bm{V}=[V(s_{1}),V(s_{2}),\ldots,V(s_{n})]" display="block"><mrow><mi>𝑽</mi><mo>=</mo><mrow><mo stretchy="false">[</mo><mrow><mi>V</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mrow><mi>V</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mi mathvariant="normal">…</mi><mo>,</mo><mrow><mi>V</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><msub><mi>s</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr>
</table>
<p class="ltx_p">that is the <math id="S0.SS0.SSS0.Px3.p11.m4" class="ltx_Math" alttext="i" display="inline"><mi>i</mi></math>th element is value of function <math id="S0.SS0.SSS0.Px3.p11.m5" class="ltx_Math" alttext="V" display="inline"><mi>V</mi></math> evaluating at state <math id="S0.SS0.SSS0.Px3.p11.m6" class="ltx_Math" alttext="s_{i}" display="inline"><msub><mi>s</mi><mi>i</mi></msub></math>. Be aware that <math id="S0.SS0.SSS0.Px3.p11.m7" class="ltx_Math" alttext="V" display="inline"><mi>V</mi></math> is a function defined in (<a href="#S0.E1" title="(1) ‣ Definition 1 (Value function). ‣ Dynamic programming. ‣ [Personal Note] Why do we have all these kinds of update?" class="ltx_ref"><span class="ltx_text ltx_ref_tag">1</span></a>).
Confusingly, definition of function <math id="S0.SS0.SSS0.Px3.p11.m8" class="ltx_Math" alttext="V" display="inline"><mi>V</mi></math> involves time, while this vector <math id="S0.SS0.SSS0.Px3.p11.m9" class="ltx_Math" alttext="\bm{V}" display="inline"><mi>𝑽</mi></math> does not.</p>
</div>
<div id="S0.SS0.SSS0.Px3.p12" class="ltx_para">
<p class="ltx_p">Next, define transition matrix, <math id="S0.SS0.SSS0.Px3.p12.m1" class="ltx_Math" alttext="\bm{P}\in\mathbb{R}^{|\mathcal{S}|\times|\mathcal{A}||\mathcal{S}|}" display="inline"><mrow><mi>𝑷</mi><mo>∈</mo><msup><mi>ℝ</mi><mrow><mrow><mrow><mo stretchy="false">|</mo><mi class="ltx_font_mathcaligraphic">𝒮</mi><mo stretchy="false">|</mo></mrow><mo>×</mo><mrow><mo stretchy="false">|</mo><mi class="ltx_font_mathcaligraphic">𝒜</mi><mo stretchy="false">|</mo></mrow></mrow><mo>⁢</mo><mrow><mo stretchy="false">|</mo><mi class="ltx_font_mathcaligraphic">𝒮</mi><mo stretchy="false">|</mo></mrow></mrow></msup></mrow></math>, <math id="S0.SS0.SSS0.Px3.p12.m2" class="ltx_Math" alttext="P(s|s^{\prime},a)" display="inline"><mrow><mi>P</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mrow><mi>s</mi><mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mo><mrow><msup><mi>s</mi><mo>′</mo></msup><mo>,</mo><mi>a</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></math>.</p>
</div>
<div id="S0.SS0.SSS0.Px3.p13" class="ltx_para">
<p class="ltx_p">There is a relation between <math id="S0.SS0.SSS0.Px3.p13.m1" class="ltx_Math" alttext="\bm{V}^{t}" display="inline"><msup><mi>𝑽</mi><mi>t</mi></msup></math> and <math id="S0.SS0.SSS0.Px3.p13.m2" class="ltx_Math" alttext="\bm{V}^{t-1}" display="inline"><msup><mi>𝑽</mi><mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow></msup></math>, which is</p>
</div>
<span class="ltx_ERROR undefined">\printbibliography</span>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Fri Apr 15 13:52:02 2022 by <a href="http://dlmf.nist.gov/LaTeXML/">LaTeXML <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg==" alt="[LOGO]"></a>
</div></footer>
</div>
</body>
</html>
